@page "{id:long}"
@model Board_Game_Software.Pages.DataSetup.Players.DetailsModel

@{
    ViewData["Title"] = "Player Details";
    var fullName = $"{Model.Player.FirstName} {Model.Player.LastName}".Trim();
}

<style>
    .avatar-container {
        width: 128px;
        height: 128px;
        border-radius: 50%;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 4px solid white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        background-color: var(--bs-tertiary-bg);
    }

        .avatar-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .avatar-large-text {
        color: white;
        font-weight: 600;
        font-size: 3rem;
        letter-spacing: -1px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .detail-label {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--bs-secondary);
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .detail-value {
        font-size: 1.1rem;
        color: var(--bs-body-color);
        font-weight: 500;
    }
</style>

<div class="container py-4">

    @if (!ModelState.IsValid)
    {
        <div class="alert alert-danger mb-4">
            @Html.ValidationSummary(false, "", new { @class = "mb-0" })
        </div>
    }

    @* --- Header Section --- *@
    <div class="card border-0 shadow-sm mb-4 overflow-hidden">
        <div class="card-body p-0">
            <div class="d-flex flex-column flex-md-row align-items-center bg-body-tertiary p-4 p-md-5">

                @* Avatar *@
                <div class="me-md-5 mb-3 mb-md-0">
                    <div class="avatar-container">
                        @if (!string.IsNullOrEmpty(Model.ProfileImageBase64))
                        {
                            <img src="@Model.ProfileImageBase64" alt="@fullName" />
                        }
                        else
                        {
                            <div class="avatar-large-text" style="background-color: @Model.GetAvatarColor(fullName);">
                                @Model.GetInitials(Model.Player.FirstName, Model.Player.LastName)
                            </div>
                        }
                    </div>
                </div>

                @* Name & Status *@
                <div class="text-center text-md-start">
                    <h1 class="display-5 fw-bold mb-1">@fullName</h1>
                    <p class="text-muted fs-5 mb-2">Registered Player</p>

                    @* Claim Status Badge *@
                    @if (Model.CurrentUserClaimedPlayerId == Model.Player.Id)
                    {
                        <span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill">
                            <i class="bi bi-check-circle-fill me-1"></i> You have claimed this profile
                        </span>
                    }
                    else if (!string.IsNullOrEmpty(Model.Player.FkdboAspNetUsers))
                    {
                        <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle rounded-pill">
                            <i class="bi bi-lock-fill me-1"></i> Claimed by another user
                        </span>
                    }
                </div>

                @* Action Buttons *@
                <div class="ms-md-auto mt-4 mt-md-0 d-flex flex-column gap-2">
                    <div class="d-flex gap-2">
                        <a asp-page="./Edit" asp-route-id="@Model.Player.Id" class="btn btn-primary px-4">
                            <i class="bi bi-pencil me-1"></i> Edit Profile
                        </a>
                        <a asp-page="./Index" class="btn btn-outline-secondary">
                            Back
                        </a>
                    </div>

                    @* Claim Button Logic *@
                    @if (Model.CurrentUserClaimedPlayerId == null && string.IsNullOrEmpty(Model.Player.FkdboAspNetUsers))
                    {
                        <form method="post" asp-page-handler="Claim" asp-route-id="@Model.Player.Id" class="mt-2">
                            <button type="submit" class="btn btn-outline-success w-100"
                                    onclick="return confirm('Are you sure you want to claim this player profile? This will link your user account to this player.');">
                                <i class="bi bi-link-45deg me-1"></i> Claim This Profile
                            </button>
                        </form>
                    }
                </div>
            </div>
        </div>
    </div>

    @* --- Details Grid --- *@
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-transparent border-0 pt-4 px-4">
            <h5 class="card-title mb-0">Personal Information</h5>
        </div>
        <div class="card-body p-4">
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="detail-label">First Name</div>
                    <div class="detail-value">@Model.Player.FirstName</div>
                </div>
                <div class="col-md-4">
                    <div class="detail-label">Last Name</div>
                    <div class="detail-value">@Model.Player.LastName</div>
                </div>
                <div class="col-md-4">
                    <div class="detail-label">Date of Birth</div>
                    <div class="detail-value">
                        @(Model.Player.DateOfBirth.HasValue? Model.Player.DateOfBirth.Value.ToString("D") : "-")
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>